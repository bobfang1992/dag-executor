// AUTO-GENERATED - DO NOT EDIT
// Generated by dsl/src/codegen.ts from registry/capabilities.toml
// Capability constants
export const CAP_RFC_0001_EXTENSIONS_CAPABILITIES_V1 = "cap.rfc.0001.extensions_capabilities.v1";
export const CAP_RFC_0005_KEY_EFFECTS_WRITES_EXACT_V1 = "cap.rfc.0005.key_effects_writes_exact.v1";
export const CapabilityRegistry = {
    "cap.rfc.0001.extensions_capabilities.v1": {
        id: "cap.rfc.0001.extensions_capabilities.v1",
        rfc: "0001",
        name: "extensions_capabilities",
        status: "implemented",
        doc: "Base extensions/capabilities mechanism for IR evolution",
        payload_schema: { "type": "object", "additionalProperties": false },
    },
    "cap.rfc.0005.key_effects_writes_exact.v1": {
        id: "cap.rfc.0005.key_effects_writes_exact.v1",
        rfc: "0005",
        name: "key_effects_writes_exact",
        status: "draft",
        doc: "Strict shape enforcement for branching meta-tasks (RFC0005)",
        payload_schema: { "type": "object", "additionalProperties": false },
    },
};
export const ALL_CAPABILITY_IDS = [
    "cap.rfc.0001.extensions_capabilities.v1",
    "cap.rfc.0005.key_effects_writes_exact.v1",
];
/** Set of capability IDs that are implemented and supported */
export const SUPPORTED_CAPABILITIES = new Set([
    "cap.rfc.0001.extensions_capabilities.v1",
]);
export const CAPABILITY_REGISTRY_DIGEST = "3537d0e4f5fe759dd852f53a81972534f50d14cb6e6a7772b5bf12cadb81d4c8";
export const CAPABILITY_COUNT = 2;
/**
 * Validate that a capability payload matches its schema.
 * Returns null if valid, error message if invalid.
 */
export function validatePayload(capId, payload) {
    const meta = CapabilityRegistry[capId];
    // Unknown capabilities are allowed - engine will validate them
    if (!meta)
        return null;
    const schema = meta.payload_schema;
    // null schema means no payload allowed
    if (schema === null) {
        if (payload !== undefined && payload !== null && (typeof payload !== "object" || Object.keys(payload).length > 0)) {
            return `Capability ${capId} does not allow a payload`;
        }
        return null;
    }
    // Validate object type
    if (schema.type === "object") {
        if (typeof payload !== "object" || payload === null) {
            return `Capability ${capId} payload must be an object`;
        }
        // Check additionalProperties: false
        if (schema.additionalProperties === false && schema.properties) {
            const allowedKeys = new Set(Object.keys(schema.properties));
            for (const key of Object.keys(payload)) {
                if (!allowedKeys.has(key)) {
                    return `Capability ${capId} payload has unexpected property: ${key}`;
                }
            }
        }
    }
    return null;
}
